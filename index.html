<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>sololeveling</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: Arial, sans-serif;
}

body {
  background: url("background.jpg") center/cover no-repeat;
}

/* ================= LOGIN ================= */
#loginOverlay {
  position: fixed;
  inset: 0;
  background: url("pic.jpg") center/cover no-repeat;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

#loginBox {
  background: rgba(0,0,0,0.7);
  padding: 30px;
  border-radius: 10px;
  color: white;
  width: 300px;
  text-align: center;
}

#loginBox input {
  width: 90%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 5px;
  border: none;
}

#loginBox button {
  padding: 10px 20px;
  border-radius: 5px;
  border: none;
  background: #4CAF50;
  color: white;
  cursor: pointer;
}

#errorMsg {
  color: red;
}

/* ================= EQUALIZER ================= */
.equalizer {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 70px;
  height: 70px;
  display: none;
  cursor: pointer;
}

.bar {
  transform-origin: bottom;
  animation: bounce 1.2s infinite ease-in-out;
}

.playing .bar {
  animation-duration: 0.6s;
}

@keyframes bounce {
  0%, 100% { transform: scaleY(0.3); }
  50% { transform: scaleY(1); }
}

/* ================= MENU BUTTON ================= */
#menuBtn {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 64px;
  height: 64px;
  background: rgba(30,30,30,0.9);
  border-radius: 50%;
  display: none;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 1000;
}

#menuBtn span {
  position: absolute;
  width: 26px;
  height: 4px;
  background: white;
  border-radius: 4px;
}

#menuBtn span:first-child { transform: translateY(-6px); }
#menuBtn span:last-child { transform: translateY(6px); }

/* ================= SIDEBAR ================= */
#sidebar {
  position: fixed;
  top: 0;
  left: -240px;
  width: 220px;
  height: 100%;
  background: rgba(0,0,0,0.95);
  padding-top: 100px;
  transition: left 0.3s ease;
  z-index: 999;
}

#sidebar.show {
  left: 0;
}

.sidebar-item {
  padding: 15px 25px;
  color: white;
  font-size: 18px;
  cursor: pointer;
}

.sidebar-item:hover {
  background: rgba(255,255,255,0.1);
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginOverlay">
  <div id="loginBox">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="checkLogin()">Login</button>
    <div id="errorMsg"></div>
  </div>
</div>

<!-- MENU BUTTON -->
<div id="menuBtn">
  <span></span>
  <span></span>
</div>

<!-- SIDEBAR -->
<div id="sidebar">
  <div class="sidebar-item" onclick="openPhotosPage()">ðŸ“· Photos</div>
</div>

<!-- EQUALIZER -->
<svg class="equalizer" id="equalizer" viewBox="0 0 100 100" onclick="toggleMusic()">
  <rect class="bar" x="10" y="20" width="10" height="60" fill="white"/>
  <rect class="bar" x="30" y="20" width="10" height="60" fill="white"/>
  <rect class="bar" x="50" y="20" width="10" height="60" fill="white"/>
  <rect class="bar" x="70" y="20" width="10" height="60" fill="white"/>
  <rect class="bar" x="90" y="20" width="10" height="60" fill="white"/>
</svg>

<!-- MUSIC -->
<audio id="bgMusic" loop muted>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<!-- APPWRITE SDK -->
<script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.0"></script>

<script>
/* ================= APPWRITE ================= */
const client = new Appwrite.Client()
  .setEndpoint("https://nyc.cloud.appwrite.io/v1")
  .setProject("695b05ea0019ea169d0f");

const account = new Appwrite.Account(client);
const databases = new Appwrite.Databases(client);
const storage = new Appwrite.Storage(client);

const DATABASE_ID = "695b05d0022af00758d";
const COLLECTION_ID = "sololeveling";
const BUCKET_ID = "avatars";

/* ================= UI ================= */
menuBtn.onclick = () => sidebar.classList.toggle("show");

/* Photos opens new page */
function openPhotosPage() {
  window.location.href = "photos.html";
}

/* ================= AUTH ================= */
async function checkLogin() {
  try {
    await account.createEmailPasswordSession(email.value, password.value);
    onLoginSuccess();
  } catch (e) {
    errorMsg.textContent = e.message;
  }
}

async function onLoginSuccess() {
  loginOverlay.style.display = "none";
  equalizer.style.display = "block";
  menuBtn.style.display = "flex";
  loadMusicState();
}

/* ================= MUSIC ================= */
const bgMusic = document.getElementById("bgMusic");
const equalizer = document.getElementById("equalizer");

function toggleMusic() {
  if (bgMusic.paused) {
    bgMusic.muted = false;
    bgMusic.play();
    equalizer.classList.add("playing");
    saveMusic(true);
  } else {
    bgMusic.pause();
    equalizer.classList.remove("playing");
    saveMusic(false);
  }
}

/* ================= DATABASE ================= */
async function saveMusic(state) {
  const user = await account.get();
  const res = await databases.listDocuments(
    DATABASE_ID,
    COLLECTION_ID,
    [Appwrite.Query.equal("userId", user.$id)]
  );

  if (res.total > 0) {
    await databases.updateDocument(
      DATABASE_ID,
      COLLECTION_ID,
      res.documents[0].$id,
      { musicOn: state }
    );
  } else {
    await databases.createDocument(
      DATABASE_ID,
      COLLECTION_ID,
      Appwrite.ID.unique(),
      { userId: user.$id, musicOn: state }
    );
  }
}

async function loadMusicState() {
  const user = await account.get();
  const res = await databases.listDocuments(
    DATABASE_ID,
    COLLECTION_ID,
    [Appwrite.Query.equal("userId", user.$id)]
  );

  if (res.total && res.documents[0].musicOn) toggleMusic();
}

/* AUTO LOGIN */
account.get().then(onLoginSuccess).catch(()=>{});
</script>

</body>
</html>
